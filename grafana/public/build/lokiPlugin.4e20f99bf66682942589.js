/*! For license information please see lokiPlugin.4e20f99bf66682942589.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"+2Nz":function(e,t,r){"use strict";r.r(t);var n,a=r("Obii"),o=r("LvDl"),i=r.n(o),u=r("F/XL"),c=r("p0ib"),s=r("67Y/"),l=r("9Z1F"),f=r("15JJ"),p=r("t8hP"),m=r("eqT+"),b=r("m257"),d=r("aCH8"),h=r.n(d),v=r("5kRJ"),y=r("iZOS"),g=r("kGJw"),O=r.n(g);function w(e){return"".concat(e||"").trim()}function x(e){for(var t=e,r=[];t;){var n=t.search(/\|=|\|~|!=|!~/);if(-1===n)break;var a=t.substr(n,2),o=0===t.substr(n).search(/!=|!~/);if(t=t.substr(n+2),!o){var i=t.search(/\|=|\|~|!=|!~/),u=void 0;-1===i?u=t.trim():(u=t.substr(0,i).trim(),t=t.substr(i));var c=u.match(/^"((?:[^\\"]|\\")*)"$/);if(!c)return[];var s=c[1],l="|~"===a;r.push(l?s:O()(s))}}return r}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function T(e,t,r){var n=e.stream,o=Object.entries(n).map((function(e){var t=_(e,2),r=t[0],n=t[1];return"".concat(r,'="').concat(n,'"')})).sort().join(""),i=new a.ArrayVector([]),u=new a.ArrayVector([]),c=new a.ArrayVector([]),s=new a.ArrayVector([]),l=!0,f=!1,p=void 0;try{for(var m,b=e.values[Symbol.iterator]();!(l=(m=b.next()).done);l=!0){var d=_(m.value,2),h=d[0],v=d[1];i.add(new Date(parseInt(h.substr(0,h.length-6),10)).toISOString()),u.add(h),c.add(v),s.add(P(h,o,v))}}catch(e){f=!0,p=e}finally{try{l||null==b.return||b.return()}finally{if(f)throw p}}return function(e,t,r,n,o,i,u){var c={refId:u,fields:[{name:"ts",type:a.FieldType.time,config:{displayName:"Time"},values:e},{name:"line",type:a.FieldType.string,config:{},values:r,labels:o},{name:"id",type:a.FieldType.string,config:{},values:n},{name:"tsNs",type:a.FieldType.time,config:{displayName:"Time ns"},values:t}],length:e.length};if(i){var s=new a.MutableDataFrame(c);return s.reverse(),s}return c}(i,u,c,s,n,t,r)}function P(e,t,r){return h()("".concat(e,"_").concat(t,"_").concat(r))}function C(e,t){var r=function(e,t){var r,n=void 0===t||i.a.isEmpty(t.legendFormat)?function(e){var t=e.__name__||"";delete e.__name__;var r=Object.entries(e).map((function(e){return"".concat(e[0],'="').concat(e[1],'"')})).join(",");return"".concat(t,"{").concat(r,"}")}(e):(a=v.a.replace(null!==(r=t.legendFormat)&&void 0!==r?r:"",t.scopedVars),o=e,a.replace(/\{\{\s*(.+?)\s*\}\}/g,(function(e,t){return o[t]?o[t]:t})));var a,o;!n&&t&&(n=t.query);return n}(e.metric,t);return{target:r,title:r,datapoints:L(e.values,t),tags:e.metric,meta:t.meta,refId:t.refId}}function L(e,t){var r=1e3*t.step,n=[],a=t.start/1e6,o=!0,i=!1,u=void 0;try{for(var c,s=e[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var l=_(c.value,2),f=l[0],p=l[1],m=parseFloat(p);isNaN(m)&&(m=null);for(var b=1e3*f,d=a;d<b;d+=r)n.push([0,d]);a=b+r,n.push([m,b])}}catch(e){i=!0,u=e}finally{try{o||null==s.return||s.return()}finally{if(i)throw u}}for(var h=t.end/1e6,v=a;v<=h;v+=r)n.push([0,v]);return n}function R(e,t,r,n,o){if(!e||0===e.length)return new y.a;var i=E(new Set(e.reduce((function(e,t){return e.concat(Object.keys(t.metric))}),[])).values()).sort(),u=new y.a;return u.refId=r,u.meta=n,u.columns=[{text:"Time",type:a.FieldType.time}].concat(E(i.map((function(e){return{text:e,filterable:!0}}))),[{text:t>1||o?"Value #".concat(r):"Value",type:a.FieldType.number}]),e.forEach((function(e){var t,r={metric:e.metric,values:e.value?[e.value]:e.values};r.values&&(r.metric?(t=u.rows).push.apply(t,E(r.values.map((function(e){var t=_(e,2),n=t[0],a=t[1];return[1e3*n].concat(E(i.map((function(e){return r.metric[e]||""}))),[parseFloat(a)])})))):u.rows.concat(r.values.map((function(e){var t=_(e,2),r=t[0],n=t[1];return[1e3*r,parseFloat(n)]}))))})),u}function F(e){var t=[];if(!e)return t;for(var r in e){var n=e[r];for(var a in n){var o=n[a],u=void 0;/time/i.test(a)&&o?u="s":/bytes.*persecond/i.test(a)?u="Bps":/bytes/i.test(a)&&(u="decbytes");var c="".concat(i.a.capitalize(r),": ").concat(a.replace(/[A-Z]/g,(function(e){return" ".concat(e.toLowerCase())})));t.push({displayName:c,value:o,unit:u})}}return t}function D(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=r>0?e.data.result:[],i=F(e.data.stats),u={lokiQueryStatKey:"Summary: total bytes processed"},c={searchWords:x(w(t.expr)),limit:r,stats:i,custom:u,preferredVisualisationType:"logs"},s=o.map((function(e){var r=T(e,a);return N(r,n),k({},r,{refId:t.refId,meta:c})}));return i.length&&!o.length?[{fields:[],length:0,refId:t.refId,meta:c}]:s}!function(e){e.Stream="streams",e.Vector="vector",e.Matrix="matrix"}(n||(n={}));var N=function(e,t){var r;if(t){var n=null!==(r=t.derivedFields)&&void 0!==r?r:[];if(n.length){var o=i.a.groupBy(n,"name"),u=Object.values(o).map(I);new a.DataFrameView(e).forEach((function(e){var t=!0,r=!1,n=void 0;try{for(var a,i=u[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var c=a.value,s=e.line.match(o[c.name][0].matcherRegex);c.values.add(s&&s[1])}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}})),e.fields=[].concat(E(e.fields),E(u))}}};function I(e){var t=e.reduce((function(e,t){return t.datasourceUid?e.push({title:"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid}}):t.url&&e.push({title:"",url:t.url}),e}),[]);return{name:e[0].name,type:a.FieldType.string,config:{links:t},values:new a.ArrayVector([])}}function A(e,t,r,a,o){var i,u={format:r.format,legendFormat:null!==(i=r.legendFormat)&&void 0!==i?i:"",start:t.start,end:t.end,step:t.step,query:t.query,responseListLength:a,refId:r.refId,meta:{preferredVisualisationType:"graph"},valueWithRefId:r.valueWithRefId,scopedVars:o};switch(e.data.resultType){case n.Vector:return e.data.result.map((function(e){return C({metric:e.metric,values:[e.value]},u)}));case n.Matrix:return e.data.result.map((function(e){return C(e,u)}));default:return[]}}function q(e,t,r,a,o,i,c){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];switch(e.data.resultType){case n.Stream:return Object(u.a)({data:D(e,t,o,i,s),key:"".concat(t.refId,"_log")});case n.Vector:case n.Matrix:return Object(u.a)({data:A(e,r,k({},t,{format:"time_series"}),a,c),key:t.refId});default:throw new Error('Unknown result type "'.concat(e.data.resultType,'".'))}}var Q=r("NPB1"),B=r("XlPw"),V=r("mrSG"),M=r("K9Ia"),U=r("FFOo"),W=r("6blF"),K=r("pugT"),z=r("S5bw"),H={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},J=function(e){function t(t,r){var n=e.call(this)||this;if(t instanceof W.a)n.destination=r,n.source=t;else{var a=n._config=V.__assign({},H);if(n._output=new M.b,"string"==typeof t)a.url=t;else for(var o in t)t.hasOwnProperty(o)&&(a[o]=t[o]);if(!a.WebSocketCtor&&WebSocket)a.WebSocketCtor=WebSocket;else if(!a.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new z.a}return n}return V.__extends(t,e),t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new z.a),this._output=new M.b},t.prototype.multiplex=function(e,t,r){var n=this;return new W.a((function(a){try{n.next(e())}catch(e){a.error(e)}var o=n.subscribe((function(e){try{r(e)&&a.next(e)}catch(e){a.error(e)}}),(function(e){return a.error(e)}),(function(){return a.complete()}));return function(){try{n.next(t())}catch(e){a.error(e)}o.unsubscribe()}}))},t.prototype._connectSocket=function(){var e=this,t=this._config,r=t.WebSocketCtor,n=t.protocol,a=t.url,o=t.binaryType,i=this._output,u=null;try{u=n?new r(a,n):new r(a),this._socket=u,o&&(this._socket.binaryType=o)}catch(e){return void i.error(e)}var c=new K.a((function(){e._socket=null,u&&1===u.readyState&&u.close()}));u.onopen=function(t){if(!e._socket)return u.close(),void e._resetState();var r=e._config.openObserver;r&&r.next(t);var n=e.destination;e.destination=U.a.create((function(t){if(1===u.readyState)try{var r=e._config.serializer;u.send(r(t))}catch(t){e.destination.error(t)}}),(function(t){var r=e._config.closingObserver;r&&r.next(void 0),t&&t.code?u.close(t.code,t.reason):i.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),u.close(),e._resetState()})),n&&n instanceof z.a&&c.add(n.subscribe(e.destination))},u.onerror=function(t){e._resetState(),i.error(t)},u.onclose=function(t){e._resetState();var r=e._config.closeObserver;r&&r.next(t),t.wasClean?i.complete():i.error(t)},u.onmessage=function(t){try{var r=e._config.deserializer;i.next(r(t))}catch(e){i.error(e)}}},t.prototype._subscribe=function(e){var t=this,r=this.source;return r?r.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())})),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(M.a);var $=r("2WpN");function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streams={}}var t,r,n;return t=e,(r=[{key:"getStream",value:function(e){var t=this,r=this.streams[e.url];if(r)return r;var n,o=new a.CircularDataFrame({capacity:e.size});return o.addField({name:"ts",type:a.FieldType.time,config:{displayName:"Time"}}),o.addField({name:"tsNs",type:a.FieldType.time,config:{displayName:"Time ns"}}),o.addField({name:"line",type:a.FieldType.string}).labels=Object(a.parseLabels)(e.query),o.addField({name:"labels",type:a.FieldType.other}),o.addField({name:"id",type:a.FieldType.string}),o.meta=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){Z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},o.meta,{preferredVisualisationType:"logs"}),r=(n=e.url,new J(n)).pipe(Object(s.a)((function(e){return function(e,t){var r=e.streams;if(r&&r.length){var n={},o=!0,i=!1,u=void 0;try{for(var c,s=t.fields[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var l=c.value;if(l.type===a.FieldType.string){l.labels&&(n=l.labels);break}}}catch(e){i=!0,u=e}finally{try{o||null==s.return||s.return()}finally{if(i)throw u}}var f=!0,p=!1,m=void 0;try{for(var b,d=r[Symbol.iterator]();!(f=(b=d.next()).done);f=!0){var h=b.value,v=Object(a.findUniqueLabels)(h.stream,n),y=Object.entries(h.stream).map((function(e){var t=_(e,2),r=t[0],n=t[1];return"".concat(r,'="').concat(n,'"')})).sort().join(""),g=!0,O=!1,w=void 0;try{for(var x,j=h.values[Symbol.iterator]();!(g=(x=j.next()).done);g=!0){var k=_(x.value,2),S=k[0],E=k[1];t.values.ts.add(new Date(parseInt(S.substr(0,S.length-6),10)).toISOString()),t.values.tsNs.add(S),t.values.line.add(E),t.values.labels.add(v),t.values.id.add(P(S,y,E))}}catch(e){O=!0,w=e}finally{try{g||null==j.return||j.return()}finally{if(O)throw w}}}}catch(e){p=!0,m=e}finally{try{f||null==d.return||d.return()}finally{if(p)throw m}}}}(e,o),[o]})),Object(l.a)((function(e){return Object(B.a)("error: ".concat(e.reason))})),Object($.a)((function(){delete t.streams[e.url]}))),this.streams[e.url]=r,r}}])&&G(t.prototype,r),n&&G(t,n),e}(),ee=r("HyWp"),te=r.n(ee),re=r("ceQ3"),ne=[].concat([{label:"sum",insertText:"sum",documentation:"Calculate sum over dimensions"},{label:"min",insertText:"min",documentation:"Select minimum over dimensions"},{label:"max",insertText:"max",documentation:"Select maximum over dimensions"},{label:"avg",insertText:"avg",documentation:"Calculate the average over dimensions"},{label:"stddev",insertText:"stddev",documentation:"Calculate population standard deviation over dimensions"},{label:"stdvar",insertText:"stdvar",documentation:"Calculate population standard variance over dimensions"},{label:"count",insertText:"count",documentation:"Count number of elements in the vector"},{label:"bottomk",insertText:"bottomk",documentation:"Smallest k elements by sample value"},{label:"topk",insertText:"topk",documentation:"Largest k elements by sample value"}],[{insertText:"count_over_time",label:"count_over_time",detail:"count_over_time(range-vector)",documentation:"The count of all values in the specified interval."},{insertText:"rate",label:"rate",detail:"rate(v range-vector)",documentation:"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period."}]),ae={comment:{pattern:/#.*/},"context-aggregation":{pattern:/((without|by)\s*)\([^)]*\)/,lookbehind:!0,inside:{"label-key":{pattern:/[^(),\s][^,)]*[^),\s]*/,alias:"attr-name"},punctuation:/[()]/}},"context-labels":{pattern:/\{[^}]*(?=})/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},function:new RegExp("\\b(?:".concat(ne.map((function(e){return e.label})).join("|"),")(?=\\s*\\()"),"i"),"context-range":[{pattern:/\[[^\]]*(?=\])/,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}},{pattern:/(offset\s+)\w+/,lookbehind:!0,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}}],number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?","i"),punctuation:/[{}()`,.]/},oe=r("itod");function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ce(e,t,r,n,a,o,i){try{var u=e[o](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function se(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ce(o,n,a,i,u,"next",e)}function u(e){ce(o,n,a,i,u,"throw",e)}i(void 0)}))}}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){he(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function he(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ve=["job","namespace"],ye=function(e){return{label:e}},ge=function(e){return{start:1e6*e.from,end:1e6*e.to}};var Oe=function(e){function t(e,r){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,o=fe(t).call(this),(n=!o||"object"!==ie(o)&&"function"!=typeof o?pe(a):o).seriesCache=new te.a(10),n.labelsCache=new te.a(10),n.cleanText=function(e){return e.replace(/[{}[\]="(),!~+\-*/^%]/g,"").trim()},n.request=function(){var e=se(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.datasource.metadataRequest(t,r);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}(),n.start=function(){return n.startTask||(n.startTask=n.fetchLogLabels(n.initialRange).then((function(){return n.started=!0,[]}))),n.startTask},n.getBeginningCompletionItems=function(e){return{suggestions:[].concat(ue(n.getEmptyCompletionItems(e).suggestions),ue(n.getTermCompletionItems().suggestions))}},n.getTermCompletionItems=function(){var e=[];return e.push({prefixMatch:!0,label:"Functions",items:ne.map((function(e){return de({},e,{kind:"function"})}))}),{suggestions:e}},n.fetchSeriesLabels=function(){var e=se(regeneratorRuntime.mark((function e(t,r){var a,o,i,u,c,s,l,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r?ge(r):{start:0,end:0},o="/loki/api/v1/series",i=a.start,u=a.end,c=n.generateCacheKey(o,i,u,t),s={match:t,start:i,end:u},l=n.seriesCache.get(c)){e.next=14;break}return n.seriesCache.set(c,{}),e.next=10,n.request(o,s);case 10:f=e.sent,p=Object(re.f)(f),m=p.values,l=m,n.seriesCache.set(c,l);case 14:return e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.addLabelValuesToOptions=function(e,t){return n.logLabelOptions.map((function(r){return r.value===e?de({},r,{children:t.map((function(e){return{label:e,value:e}}))}):r}))},n.datasource=e,n.labelKeys=[],n.logLabelFetchTs=0,Object.assign(pe(n),r),n}var r,n,o,u,c,s,l,f,p,m,b,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(t,e),r=t,(n=[{key:"getSyntax",value:function(){return ae}},{key:"getLabelKeys",value:function(){return this.labelKeys}},{key:"provideCompletionItems",value:(d=se(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,u,c,s,l,f,p,m,b,d,h,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wrapperClasses,a=t.value,o=t.prefix,i=t.text,u={suggestions:[]},a){e.next=4;break}return e.abrupt("return",u);case 4:if(c=0===(null==a?void 0:a.document.text.length),s=a.document.getTextsAtRange(a.selection),l=1===s.size?s.first().getText():null,f=l?l[a.selection.anchor.offset]:null,p=n.length>3,m=o&&!p,b=!f||")"===f,d=o&&!i.match(/^['"~=\]})\s]+$/)&&b,h=/[+\-*/^%]/,v=i.match(h),!n.includes("context-range")){e.next=18;break}return e.abrupt("return",this.getRangeCompletionItems());case 18:if(!n.includes("context-labels")){e.next=24;break}return e.next=21,this.getLabelCompletionItems(t,r);case 21:return e.abrupt("return",e.sent);case 24:if(!c){e.next=28;break}return e.abrupt("return",this.getEmptyCompletionItems(r));case 28:if(!m||!b||v){e.next=32;break}return e.abrupt("return",this.getBeginningCompletionItems(r));case 32:if(!m||!d){e.next=34;break}return e.abrupt("return",this.getTermCompletionItems());case 34:return e.abrupt("return",u);case 35:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"getEmptyCompletionItems",value:function(e){var t=null==e?void 0:e.history,r=[];if(t&&t.length){var n=i.a.chain(t).map((function(e){return e.query.expr})).filter().uniq().take(10).map(ye).map((function(e){return function(e,t){var r=Date.now()-864e5,n=t.filter((function(t){return t.ts>r&&t.query.expr===e.label})),o="Queried ".concat(n.length," times in the last 24h."),i=n[0];if(i){var u=Object(a.dateTime)(i.ts).fromNow();o="".concat(o," Last queried ").concat(u,".")}return de({},e,{documentation:o})}(e,t)})).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:n})}return{suggestions:r}}},{key:"getRangeCompletionItems",value:function(){return{context:"context-range",suggestions:[{label:"Range vector",items:ue(oe.b)}]}}},{key:"getLabelCompletionItems",value:(b=se(regeneratorRuntime.mark((function e(t,r){var n,a,o,u,c,s,l,f,p,m,b,d,h,v,y,g,O,w,x,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.text,a=t.wrapperClasses,o=t.labelKey,u=t.value,c=r.absoluteRange,s="context-labels",l=[],u){e.next=6;break}return e.abrupt("return",{context:s,suggestions:[]});case 6:f=u.anchorBlock.getText(),p=u.selection.anchor.offset,m=n.match(/^(=|=~|!=|!~)/);try{d=Object(re.d)(f,p),b=d.selector}catch(e){b="{}"}if(m||"{}"!==b){e.next=15;break}return e.next=13,this.start();case 13:return h=this.getLabelKeys(),e.abrupt("return",{context:s,suggestions:[{label:"Labels",items:h.map(ye)}]});case 15:if(v=d?d.labelKeys:[],!b){e.next=27;break}if("{}"!==b||!o){e.next=24;break}return e.next=20,this.getLabelValues(o,c);case 20:g=e.sent,y=he({},o,g),e.next=27;break;case 24:return e.next=26,this.getSeriesLabels(b,c);case 26:y=e.sent;case 27:if(y){e.next=30;break}return console.warn("Server did not return any values for selector = ".concat(b)),e.abrupt("return",{context:s,suggestions:l});case 30:return n&&m||a.includes("attr-value")?o&&y[o]&&(s="context-label-values",l.push({label:'Label values for "'.concat(o,'"'),items:y[o].map(ye)})):(O=y?Object.keys(y):ve)&&(w=i.a.difference(O,v)).length&&(x=w.map((function(e){return{label:e}})),j={label:"Labels",items:x},l.push(j)),e.abrupt("return",{context:s,suggestions:l});case 32:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"importQueries",value:(m=se(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("prometheus"!==r){e.next=2;break}return e.abrupt("return",Promise.all(t.map(function(){var e=se(regeneratorRuntime.mark((function e(t){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.importPrometheusQuery(t.expr);case 2:return r=e.sent,a=t,o=Object.assign({},a),e.abrupt("return",de({},o,{expr:r}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 2:return e.abrupt("return",t.map((function(e){return{refId:e.refId,expr:""}})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"importPrometheusQuery",value:(p=se(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(r=t.match(re.g)){e.next=5;break}return e.abrupt("return","");case 5:return n=r[0],a={},n.replace(re.c,(function(e,t,r,n){return a[t]={value:n,operator:r},""})),e.next=10,this.start();case 10:if(o=this.labelKeys,i={},o&&o.length)for(u in a)o&&o.includes(u)&&(i[u]=a[u]);else i=a;return c=Object.keys(i).sort(),s=c.map((function(e){return"".concat(e).concat(i[e].operator).concat(i[e].value)})).join(","),e.abrupt("return",["{",s,"}"].join(""));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getSeriesLabels",value:(f=se(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lookupsDisabled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.prev=2,e.next=5,this.fetchSeriesLabels(t,r);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e,t){return f.apply(this,arguments)})},{key:"fetchLogLabels",value:(l=se(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,this.logLabelFetchTs=Date.now().valueOf(),r=t?ge(t):{},e.next=6,this.request("/loki/api/v1/label",r);case 6:n=e.sent,this.labelKeys=n.slice().sort(),this.logLabelOptions=this.labelKeys.map((function(e){return{label:e,value:e,isLeaf:!1}})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0);case 14:return e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e){return l.apply(this,arguments)})},{key:"refreshLogLabels",value:(s=se(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.labelKeys&&Date.now().valueOf()-this.logLabelFetchTs>3e4||r)){e.next=3;break}return e.next=3,this.fetchLogLabels(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"generateCacheKey",value:function(e,t,r,n){return[e,this.roundTime(t),this.roundTime(r),n].join()}},{key:"roundTime",value:function(e){return e?Math.floor(e/1e6/1e3/60/5):0}},{key:"getLabelValues",value:(c=se(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:this.initialRange,e.next=3,this.fetchLabelValues(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchLabelValues",value:(u=se(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,u,c,s,l,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="/loki/api/v1/label/".concat(t,"/values"),o=[],i=r?ge(r):{start:0,end:0},u=i.start,c=i.end,s=this.generateCacheKey(a,u,c,t),l={start:u,end:c},f=this.labelsCache.get(s)){e.next=24;break}return e.prev=8,this.labelsCache.set(s,[]),e.next=12,this.request(a,l);case 12:p=e.sent,o=p.slice().sort(),f=o,this.labelsCache.set(s,f),this.logLabelOptions=this.addLabelValuesToOptions(t,o),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),console.error(e.t0);case 22:e.next=25;break;case 24:this.logLabelOptions=this.addLabelValuesToOptions(t,f);case 25:return e.abrupt("return",null!==(n=f)&&void 0!==n?n:[]);case 26:case"end":return e.stop()}}),e,this,[[8,19]])}))),function(e,t){return u.apply(this,arguments)})}])&&le(r.prototype,n),o&&le(r,o),t}(a.LanguageProvider),we=r("zsCE");function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ke(e,t,r,n,a,o,i){try{var u=e[o](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function Se(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ke(o,n,a,i,u,"next",e)}function u(e){ke(o,n,a,i,u,"throw",e)}i(void 0)}))}}function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){Te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fe="".concat("/loki/api/v1","/query_range"),De="".concat("/loki/api/v1","/query"),Ne={direction:"BACKWARD",limit:1e3,query:""};function Ie(e){return"string"==typeof e?e.replace(/'/g,"\\\\'"):e}function Ae(e){return"string"==typeof e?Ie(e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):e}var qe=function(e){function t(e,r){var o,i,c,p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c=this,p=Ce(t).call(this,e),(i=!p||"object"!==xe(p)&&"function"!=typeof p?Le(c):p).instanceSettings=e,i.templateSrv=r,i.streams=new Y,i.runInstantQuery=function(e,t,r){var a=i.getTime(t.range.to,!0),o={query:e.expr,time:"".concat(a+(1e9-a%1e9)),limit:Math.min(t.maxDataPoints||1/0,i.maxLines)},u={preferredVisualisationType:"table"};return i._request(De,o).pipe(Object(s.a)((function(t){return t.data.data.resultType===n.Stream?{data:[],key:"".concat(e.refId,"_instant")}:{data:[R(t.data.data.result,r,e.refId,u,!0)],key:"".concat(e.refId,"_instant")}})),Object(l.a)((function(t){return i.throwUnless(t,404===t.status,e)})))},i.runRangeQuery=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0;n=void 0===e.maxLines?Math.min(t.maxDataPoints||1/0,i.maxLines):isNaN(e.maxLines)?i.maxLines:e.maxLines;var a=_e({},t,{maxDataPoints:n});if(t.liveStreaming)return i.runLiveQuery(e,a);var o=i.createRangeQuery(e,a);return i._request(Fe,o).pipe(Object(l.a)((function(t){return i.throwUnless(t,404===t.status,e)})),Object(f.a)((function(a){return q(a.data,e,o,r,n,i.instanceSettings.jsonData,t.scopedVars,t.reverse)})))},i.runLiveQuery=function(e,t){var r=i.createLiveTarget(e,t);return i.streams.getStream(r).pipe(Object(s.a)((function(e){return{data:e,key:"loki-".concat(r.refId),state:a.LoadingState.Streaming}})))},i.getLogRowContext=function(e,t){var r=i.prepareLogRowContextQueryTarget(e,t&&t.limit||10,t&&t.direction||"BACKWARD"),n=t&&"FORWARD"===t.direction;return i._request(Fe,r).pipe(Object(l.a)((function(e){if(404===e.status)return Object(u.a)(e);throw{message:"Error during context query. Please check JS console logs.",status:e.status,statusText:e.statusText}})),Object(f.a)((function(e){return Object(u.a)({data:e.data?e.data.data.result.map((function(e){return T(e,n)})):[]})}))).toPromise()},i.prepareLogRowContextQueryTarget=function(e,t,r){var n=Object.keys(e.labels).map((function(t){return"".concat(t,'="').concat(e.labels[t].replace(/\\/g,"\\\\"),'"')})).join(","),o={limit:t,query:"{".concat(n,"}"),expr:"{".concat(n,"}"),direction:r},i=new a.FieldCache(e.dataFrame).getFieldByName("tsNs").values.get(e.rowIndex);return _e({},o,"BACKWARD"===r?{start:e.timeEpochMs-72e5+"000000",end:i,direction:r}:{start:i,end:e.timeEpochMs+72e5+"000000"})},i.languageProvider=new Oe(Le(i));var m=e.jsonData||{};return i.maxLines=parseInt(null!==(o=m.maxLines)&&void 0!==o?o:"0",10)||1e3,i}var r,i,d,h,v,y,g,O,w,j;return t.$inject=["instanceSettings","templateSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(t,e),r=t,(i=[{key:"_request",value:function(e,t,r){var n=this.instanceSettings.url,a=t?Object(we.c)(t):"",o=_e({},r,{url:"".concat(n).concat(e).concat(a.length?"?".concat(a):"")});return Object(p.getBackendSrv)().fetch(o)}},{key:"query",value:function(e){var t=this,r=[],n=e.targets.filter((function(e){return e.expr&&!e.hide})).map((function(r){return _e({},r,{expr:t.templateSrv.replace(r.expr,e.scopedVars,t.interpolateQueryExpr)})})),i=!0,s=!1,l=void 0;try{for(var f,p=n[Symbol.iterator]();!(i=(f=p.next()).done);i=!0){var m=f.value;e.app===a.CoreApp.Explore&&r.push(this.runInstantQuery(m,e,n.length)),r.push(this.runRangeQuery(m,e,n.length))}}catch(e){s=!0,l=e}finally{try{i||null==p.return||p.return()}finally{if(s)throw l}}return Object(o.isEmpty)(r)?Object(u.a)({data:[],state:a.LoadingState.Done}):c.a.apply(void 0,r)}},{key:"createRangeQuery",value:function(e,t){var r=e.expr,n={};if(t.range){var a=this.getTime(t.range.from,!1),o=this.getTime(t.range.to,!0),i=Math.ceil((o-a)/1e6),u=Math.ceil(this.adjustInterval(t.intervalMs||1e3,i)/1e3),c={start:a-a%1e9,end:o+(1e9-o%1e9)};n={start:c.start,end:c.end,step:u}}return _e({},Ne,{},n,{query:r,limit:Math.min(t.maxDataPoints||1/0,this.maxLines)})}},{key:"createLiveTarget",value:function(e,t){var r=e.expr,n=this.instanceSettings.url,a=Object(we.c)({query:r});return{query:r,url:Object(b.e)("".concat(n,"/loki/api/v1/tail?").concat(a)),refId:e.refId,size:Math.min(t.maxDataPoints||1/0,this.maxLines)}}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this,n=e;return e&&e.length&&(n=e.map((function(e){return _e({},e,{datasource:r.name,expr:r.templateSrv.replace(e.expr,t,r.interpolateQueryExpr)})}))),n}},{key:"getQueryDisplayText",value:function(e){return e.expr}},{key:"importQueries",value:(j=Se(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.languageProvider.importQueries(t,r.id));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"metadataRequest",value:(w=Se(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._request(t,r,{hideFromInspector:!0}).toPromise();case 2:return n=e.sent,e.abrupt("return",n.data.data||n.data.values||[]);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"metricFindQuery",value:(O=Se(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.resolve([]));case 2:return n=this.templateSrv.replace(t,{},this.interpolateQueryExpr),e.next=5,this.processMetricFindQuery(n,null==r?void 0:r.range);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"processMetricFindQuery",value:(g=Se(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=/^label_names\(\)\s*$/,a=/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/,o=r||Object(Q.a)().timeRange(),i=ge({from:o.from.valueOf(),to:o.to.valueOf()}),!t.match(n)){e.next=9;break}return e.next=8,this.labelNamesQuery(i);case 8:return e.abrupt("return",e.sent);case 9:if(!(u=t.match(a))){e.next=14;break}return e.next=13,this.labelValuesQuery(u[2],i);case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",Promise.resolve([]));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"labelNamesQuery",value:(y=Se(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat("/loki/api/v1","/label"),e.next=3,this.metadataRequest(r,t);case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return{text:e}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"labelValuesQuery",value:(v=Se(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat("/loki/api/v1","/label/").concat(t,"/values"),e.next=3,this.metadataRequest(n,r);case 3:return a=e.sent,e.abrupt("return",a.map((function(e){return{text:e}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"interpolateQueryExpr",value:function(e,t){return t.multi||t.includeAll?"string"==typeof e?Ae(e):Object(o.map)(e,Ae).join("|"):Ie(e)}},{key:"modifyQuery",value:function(e,t){var r,n=null!==(r=e.expr)&&void 0!==r?r:"";switch(t.type){case"ADD_FILTER":n=Object(m.a)(n,t.key,t.value,void 0,!0);break;case"ADD_FILTER_OUT":n=Object(m.a)(n,t.key,t.value,"!=",!0)}return _e({},e,{expr:n})}},{key:"getHighlighterExpression",value:function(e){return x(e.expr)}},{key:"getTime",value:function(e,t){return"string"==typeof e&&(e=a.dateMath.parse(e,t)),Math.ceil(1e6*e.valueOf())}},{key:"testDatasource",value:function(){var e=Date.now()-6e5,t="".concat(e,"000000");return this._request("".concat("/loki/api/v1","/label"),{start:t}).pipe(Object(s.a)((function(e){var t,r;return((null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.data)||(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.values)||[]).length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."}})),Object(l.a)((function(e){var t="Loki: ";return e.statusText?t+=e.statusText:t+="Cannot connect to Loki",e.status&&(t+=". ".concat(e.status)),e.data&&e.data.message?t+=". ".concat(e.data.message):e.data&&(t+=". ".concat(e.data)),Object(u.a)({status:"error",message:t})}))).toPromise()}},{key:"annotationQuery",value:(h=Se(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,c,s,l,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.annotation.expr){e.next=2;break}return e.abrupt("return",[]);case 2:return r=this.templateSrv.replace(t.annotation.expr,{},this.interpolateQueryExpr),n={refId:"annotation-".concat(t.annotation.name),expr:r},e.next=6,this.runRangeQuery(n,t).toPromise();case 6:for(o=e.sent,i=o.data,u=[],c=!0,s=!1,l=void 0,e.prev=12,f=function(){var e=m.value,t=[],r=!0,n=!1,o=void 0;try{for(var i,c=e.fields[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value;s.labels&&t.push.apply(t,je(new Set(Object.values(s.labels).map((function(e){return e.trim()})))))}}catch(e){n=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(n)throw o}}new a.DataFrameView(e).forEach((function(e){u.push({time:new Date(e.ts).valueOf(),text:e.line,tags:t})}))},p=i[Symbol.iterator]();!(c=(m=p.next()).done);c=!0)f();e.next=21;break;case 17:e.prev=17,e.t0=e.catch(12),s=!0,l=e.t0;case 21:e.prev=21,e.prev=22,c||null==p.return||p.return();case 24:if(e.prev=24,!s){e.next=27;break}throw l;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",u);case 30:case"end":return e.stop()}}),e,this,[[12,17,21,29],[22,,24,28]])}))),function(e){return h.apply(this,arguments)})},{key:"showContextToggle",value:function(e){return!0===(e&&e.searchWords&&e.searchWords.length>0)}},{key:"throwUnless",value:function(e,t,r){if(t)return Object(u.a)(e);throw this.processError(e,r)}},{key:"processError",value:function(e,t){var r=Object(o.cloneDeep)(e);return e.data.message.includes("escape")&&t.expr.includes("\\")&&(r.data.message="Error: ".concat(e.data.message,". Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://github.com/grafana/loki/blob/master/docs/logql.md.")),r}},{key:"adjustInterval",value:function(e,t){return 0!==e&&t/e>11e3&&(e=Math.ceil(t/11e3)),Math.max(e,1e3)}}])&&Pe(r.prototype,i),d&&Pe(r,d),t}(a.DataSourceApi),Qe=r("q1tI"),Be=r.n(Qe);function Ve(e){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Me(e,t,r,n,a,o,i){try{var u=e[o](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function Ue(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Me(o,n,a,i,u,"next",e)}function u(e){Me(o,n,a,i,u,"throw",e)}i(void 0)}))}}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ze(e,t){return!t||"object"!==Ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $e=['{job="default/prometheus"}'],Xe=["job","app","k8s_app"],Ze=[{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}],Ge=function(e){function t(){var e,r;We(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=ze(this,(e=He(t)).call.apply(e,[this].concat(a)))).state={userExamples:$e},r.checkUserLabels=Ue(regeneratorRuntime.mark((function e(){var t,n,a,i,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=null===(t=r.props.datasource)||void 0===t?void 0:t.languageProvider).started){e.next=12;break}if(a=n.getLabelKeys()||[],!(i=Xe.find((function(e){return a.includes(e)})))){e.next=10;break}return e.next=7,n.getLabelValues(i);case 7:u=e.sent,c=Object(o.shuffle)(u).slice(0,5).map((function(e){return"{".concat(i,'="').concat(e,'"}')})),r.setState({userExamples:c});case 10:e.next=13;break;case 12:r.scheduleUserLabelChecking();case 13:case"end":return e.stop()}}),e)}))),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){this.scheduleUserLabelChecking()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.userLabelTimer)}},{key:"scheduleUserLabelChecking",value:function(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}},{key:"renderExpression",value:function(e){var t=this.props.onClickExample;return Be.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(r){return t({refId:"A",expr:e})}},Be.a.createElement("code",null,e))}},{key:"render",value:function(){var e=this,t=this.state.userExamples;return Be.a.createElement("div",null,Be.a.createElement("h2",null,"Loki Cheat Sheet"),Be.a.createElement("div",{className:"cheat-sheet-item"},Be.a.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),Be.a.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Log labels selector."),Be.a.createElement("div",{className:"cheat-sheet-item__label"},"Alternatively, you can write a stream selector into the query field:"),this.renderExpression('{job="default/prometheus"}'),t!==$e&&t.length>0?Be.a.createElement("div",null,Be.a.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map((function(t){return e.renderExpression(t)}))):null),Be.a.createElement("div",{className:"cheat-sheet-item"},Be.a.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),Be.a.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),Be.a.createElement("div",{className:"cheat-sheet-item"},Be.a.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),Be.a.createElement("div",{className:"cheat-sheet-item__label"},Be.a.createElement("a",{href:"https://github.com/grafana/loki/blob/master/docs/logql.md#filter-expression",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),Ze.map((function(t){return Be.a.createElement("div",{className:"cheat-sheet-item",key:t.expression},Be.a.createElement("div",{className:"cheat-sheet-item__title"},t.title),e.renderExpression(t.expression),Be.a.createElement("div",{className:"cheat-sheet-item__label"},t.label))})))}}])&&Ke(r.prototype,n),a&&Ke(r,a),t}(Qe.PureComponent),Ye=r("KwPh"),et=r("Yj82");function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function rt(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var nt=function(e){var t=e.datasource,r=e.range,n=rt(e,["datasource","range"]),a={from:r.from.valueOf(),to:r.to.valueOf()},o=Object(et.a)(t.languageProvider,a),i=o.isSyntaxReady,u=o.setActiveOption,c=o.refreshLabels,s=o.syntax,l=o.logLabelOptions;return Be.a.createElement(Ye.a,tt({datasource:t,onLoadOptions:u,onLabelsRefresh:c,absoluteRange:a,syntax:s,syntaxLoaded:i,logLabelOptions:l},n))},at=r("kDLi");var ot=Object(Qe.memo)((function(e){var t=e.label,r=e.onChangeFunc,n=e.onKeyDownFunc,a=e.value,o=e.type,i=e.min;return Be.a.createElement("div",{className:"gf-form-inline"},Be.a.createElement("div",{className:"gf-form"},Be.a.createElement(at.InlineFormLabel,{width:5},t),Be.a.createElement("input",{type:o,className:"gf-form-input width-4",placeholder:"auto",onChange:r,onKeyDown:n,min:i,value:a})))}));function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ct=Object(Qe.memo)((function(e){var t,r=e.range,n=e.query,a=e.data,o=e.datasource,i=e.history,u=e.onChange,c=e.onRunQuery;function s(t){var r=e.query;(0,e.onChange)(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach((function(t){ut(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r,{maxLines:l(t)}))}function l(e){return 0===e.length?NaN:e.length>0&&(isNaN(+e)||+e<0)?0:+e}return Be.a.createElement(nt,{datasource:o,query:n,onChange:u,onBlur:function(){},onRunQuery:c,history:i,data:a,range:r,ExtraFieldElement:Be.a.createElement(ot,{label:"Line limit",onChangeFunc:function(e){n.maxLines!==l(e.currentTarget.value)&&s(e.currentTarget.value)},onKeyDownFunc:function(e){"Enter"===e.key&&c()},value:(null==n?void 0:null===(t=n.maxLines)||void 0===t?void 0:t.toString())||"",type:"number",min:0})})}));function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bt=function(e){function t(e){var r,n,a,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,o=ft(t).call(this,e),(n=!o||"object"!==st(o)&&"function"!=typeof o?pt(a):o).onFieldChange=function(e,t){n.query.expr=e.expr},n.onLegendChange=function(e){var t=e.currentTarget.value;n.query.legendFormat=t,n.setState({legendFormat:t})},n.onRunQuery=function(){var e=pt(n).query;n.props.onChange(e),n.props.onRunQuery()};var i=Object.assign({},{expr:"",legendFormat:""},e.query);return n.query=i,n.state={legendFormat:null!==(r=i.legendFormat)&&void 0!==r?r:""},n}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.datasource,r=e.query,n=e.data,a=e.range,o=this.state.legendFormat;return Be.a.createElement("div",null,Be.a.createElement(nt,{datasource:t,query:r,onChange:this.onFieldChange,onRunQuery:this.onRunQuery,history:[],data:n,range:a}),Be.a.createElement("div",{className:"gf-form-inline"},Be.a.createElement("div",{className:"gf-form"},Be.a.createElement(at.InlineFormLabel,{width:7,tooltip:"Controls the name of the time series, using name or pattern. For example {{hostname}} will be replaced with label value for the label hostname. The legend only applies to metric queries."},"Legend"),Be.a.createElement("input",{type:"text",className:"gf-form-input",placeholder:"legend format",value:o,onChange:this.onLegendChange,onBlur:this.onRunQuery}))))}}])&&lt(r.prototype,n),a&&lt(r,a),t}(Qe.PureComponent);function dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ht=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.annotation.target=this.annotation.target||{},this.onQueryChange=this.onQueryChange.bind(this)}var t,r,n;return t=e,(r=[{key:"onQueryChange",value:function(e){this.annotation.expr=e}}])&&dt(t.prototype,r),n&&dt(t,n),e}();ht.templateUrl="partials/annotations.editor.html";var vt=at.LegacyForms.FormField,yt=function(e){var t=e.value,r=e.onChange;return Be.a.createElement(vt,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:Be.a.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:function(e){return r(e.currentTarget.value)},spellCheck:!1,placeholder:"1000"}),tooltip:Be.a.createElement(Be.a.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},gt=r("kDDq"),Ot=r("Wkk1"),wt=r("WnbS"),xt=r("tLXD");function jt(){var e=Rt(["\n          width: 100%;\n        "]);return jt=function(){return e},e}function kt(){var e=Rt(["\n            margin-left: 8px;\n          "]);return kt=function(){return e},e}function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach((function(t){_t(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pt(){var e=Rt(["\n    flex: 3;\n  "]);return Pt=function(){return e},e}function Ct(){var e=Rt(["\n    flex: 2;\n  "]);return Ct=function(){return e},e}function Lt(){var e=Rt(["\n    display: flex;\n    align-items: baseline;\n  "]);return Lt=function(){return e},e}function Rt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Ft=at.LegacyForms.Switch,Dt=at.LegacyForms.FormField,Nt=Object(at.stylesFactory)((function(){return{row:Object(gt.css)(Lt()),nameField:Object(gt.css)(Ct()),regexField:Object(gt.css)(Pt())}})),It=function(e){var t=e.value,r=e.onChange,n=e.onDelete,a=e.suggestions,o=e.className,i=Nt(),u=Tt(Object(Qe.useState)(!!t.datasourceUid),2),c=u[0],s=u[1],l=Object(xt.a)(t.datasourceUid);Object(Qe.useEffect)((function(){l||!t.datasourceUid||c||s(!0),l&&!t.datasourceUid&&c&&s(!1)}),[l,t.datasourceUid,c]);var f=function(e){return function(n){r(Et({},t,_t({},e,n.currentTarget.value)))}};return Be.a.createElement("div",{className:o},Be.a.createElement("div",{className:i.row},Be.a.createElement(Dt,{className:i.nameField,labelWidth:5,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:f("name")}),Be.a.createElement(Dt,{className:i.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:f("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),Be.a.createElement(at.Button,{variant:"destructive",title:"Remove field",icon:"times",onClick:function(e){e.preventDefault(),n()},className:Object(gt.css)(kt())})),Be.a.createElement(Dt,{label:c?"Query":"URL",labelWidth:5,inputEl:Be.a.createElement(at.DataLinkInput,{placeholder:c?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:function(e){return r(Et({},t,{url:e}))},suggestions:a}),className:Object(gt.css)(jt())}),Be.a.createElement("div",{className:i.row},Be.a.createElement(Ft,{label:"Internal link",checked:c,onChange:function(){c&&r(Et({},t,{datasourceUid:void 0})),s(!c)}}),c&&Be.a.createElement(At,{onChange:function(e){r(Et({},t,{datasourceUid:e}))},datasourceUid:t.datasourceUid})))},At=function(e){var t=e.datasourceUid,r=e.onChange,n=Object(wt.a)().getExternal().filter((function(e){return e.meta.tracing})).map((function(e){return{value:e.uid,name:e.name,meta:e.meta}})),a=t&&n.find((function(e){return e.value===t}));return Be.a.createElement(Ot.b,{onChange:function(e){return r(e.value)},datasources:n,current:a||void 0})},qt=r("TSYQ"),Qt=r.n(qt),Bt=r("Xc1M");function Vt(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n                width: 100%;\n              "]);return Vt=function(){return e},e}function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ut=at.LegacyForms.FormField,Wt=function(e){var t=e.derivedFields,r=e.className,n=Mt(Object(Qe.useState)(""),2),o=n[0],i=n[1],u=[];return o&&t&&(u=function(e,t){return e.filter((function(e){return e.name&&e.matcherRegex})).map((function(e){try{var r=t.match(e.matcherRegex),n=r&&r[1],o=null;return e.url&&n&&(o=Object(Bt.a)({name:"",type:a.FieldType.string,values:new a.ArrayVector([n]),config:{links:[{title:"",url:e.url}]}},0,(function(){}),{})[0]),{name:e.name,value:n||"<no match>",href:o&&o.href}}catch(t){return{name:e.name,error:t}}}))}(t,o)),Be.a.createElement("div",{className:r},Be.a.createElement(Ut,{labelWidth:12,label:"Debug log message",inputEl:Be.a.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Qt()("gf-form-input gf-form-textarea",Object(gt.css)(Vt())),value:o,onChange:function(e){return i(e.currentTarget.value)}})}),!!u.length&&Be.a.createElement(Kt,{fields:u}))},Kt=function(e){var t=e.fields;return Be.a.createElement("table",{className:"filter-table"},Be.a.createElement("thead",null,Be.a.createElement("tr",null,Be.a.createElement("th",null,"Name"),Be.a.createElement("th",null,"Value"),Be.a.createElement("th",null,"Url"))),Be.a.createElement("tbody",null,t.map((function(e){var t=e.value;return e.error?t=e.error.message:e.href&&(t=Be.a.createElement("a",{href:e.href},t)),Be.a.createElement("tr",{key:"".concat(e.name,"=").concat(e.value)},Be.a.createElement("td",null,e.name),Be.a.createElement("td",null,t),Be.a.createElement("td",null,e.href?Be.a.createElement("a",{href:e.href},e.href):""))}))))};function zt(){var e=Gt(["\n              margin-bottom: 10px;\n            "]);return zt=function(){return e},e}function Ht(){var e=Gt(["\n              margin-right: 10px;\n            "]);return Ht=function(){return e},e}function Jt(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function $t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Xt(){var e=Gt(["\n    margin-bottom: ",";\n  "]);return Xt=function(){return e},e}function Zt(){var e=Gt(["\n    padding-bottom: ",";\n    color: ",";\n  "]);return Zt=function(){return e},e}function Gt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Yt=Object(at.stylesFactory)((function(e){return{infoText:Object(gt.css)(Zt(),e.spacing.md,e.colors.textWeak),derivedField:Object(gt.css)(Xt(),e.spacing.sm)}})),er=function(e){var t=e.value,r=e.onChange,n=Object(at.useTheme)(),o=Yt(n),i=$t(Object(Qe.useState)(!1),2),u=i[0],c=i[1];return Be.a.createElement(Be.a.Fragment,null,Be.a.createElement("h3",{className:"page-heading"},"Derived fields"),Be.a.createElement("div",{className:o.infoText},"Derived fields can be used to extract new fields from the log message and create link from it's value."),Be.a.createElement("div",{className:"gf-form-group"},t&&t.map((function(e,n){return Be.a.createElement(It,{className:o.derivedField,key:n,value:e,onChange:function(e){var a=Jt(t);a.splice(n,1,e),r(a)},onDelete:function(){var e=Jt(t);e.splice(n,1),r(e)},suggestions:[{value:a.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:a.VariableOrigin.Value}]})})),Be.a.createElement("div",null,Be.a.createElement(at.Button,{variant:"secondary",className:Object(gt.css)(Ht()),icon:"plus",onClick:function(e){e.preventDefault();var n=[].concat(Jt(t||[]),[{name:"",matcherRegex:""}]);r(n)}},"Add"),t&&t.length>0&&Be.a.createElement(at.Button,{variant:"secondary",onClick:function(){return c(!u)}},u?"Hide example log message":"Show example log message"))),u&&Be.a.createElement("div",{className:"gf-form-group"},Be.a.createElement(Wt,{className:Object(gt.css)(zt()),derivedFields:t})))};function tr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(r),!0).forEach((function(t){nr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function nr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ar=function(e){return function(t,r){return rr({},t,{jsonData:rr({},t.jsonData,nr({},e,r))})}},or=ar("maxLines"),ir=ar("derivedFields");r.d(t,"plugin",(function(){return ur}));var ur=new a.DataSourcePlugin(qe).setQueryEditor(bt).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return Be.a.createElement(Be.a.Fragment,null,Be.a.createElement(at.DataSourceHttpSettings,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:r}),Be.a.createElement("div",{className:"gf-form-group"},Be.a.createElement("div",{className:"gf-form-inline"},Be.a.createElement("div",{className:"gf-form"},Be.a.createElement(yt,{value:t.jsonData.maxLines||"",onChange:function(e){return r(or(t,e))}})))),Be.a.createElement(er,{value:t.jsonData.derivedFields,onChange:function(e){return r(ir(t,e))}}))})).setExploreQueryField(ct).setExploreStartPage(Ge).setAnnotationQueryCtrl(ht)},ANhw:function(e,t){var r,n;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var a=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(a>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,a=0;n<e.length;a=++n%4)0!=a&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*a+8)-1)<<2*a|r.indexOf(e.charAt(n))>>>6-2*a);return t}},e.exports=n},BEtg:function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},Wkk1:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r("q1tI"),a=r.n(n),o=r("kDLi"),i=r("Csm0");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,l(t).call(this,e))).onChange=function(e){var t=r.props.datasources.find((function(t){return t.name===e.value}));t&&r.props.onChange(t)},r}var r,n,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.datasources,r=e.current,n=e.autoFocus,u=e.hideTextValue,c=e.onBlur,s=e.openMenuOnFocus,l=e.showLoading,f=e.placeholder,p=e.invalid,m=t.map((function(e){return{value:e.name,label:e.name,imgUrl:e.meta.info.logos.small}})),b=r&&{label:r.name.substr(0,37),value:r.name,imgUrl:r.meta.info.logos.small,loading:l,hideText:u};return a.a.createElement("div",{"aria-label":i.selectors.components.DataSourcePicker.container},a.a.createElement(o.Select,{className:"ds-picker select-container",isMulti:!1,isClearable:!1,backspaceRemovesValue:!1,onChange:this.onChange,options:m,autoFocus:n,onBlur:c,openMenuOnFocus:s,maxMenuHeight:500,menuPlacement:"bottom",placeholder:f,noOptionsMessage:"No datasources found",value:b,invalid:p}))}}])&&c(r.prototype,n),u&&c(r,u),t}(n.PureComponent);p.defaultProps={autoFocus:!1,openMenuOnFocus:!1,placeholder:"Select datasource"},t.b=p},Xc1M:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("GkHB"),a=r("XcIw"),o=r("t8hP"),i=function(e,t,r,i){var u={};return u.__value={value:{raw:e.values.get(t)},text:"Raw value"},e.config.links?e.config.links.map((function(t){if(t.internal)return Object(a.b)(t,u,i,e,{onClickFn:r,replaceVariables:Object(o.getTemplateSrv)().replace.bind(Object(o.getTemplateSrv)()),getDataSourceSettingsByUid:Object(o.getDataSourceSrv)().getDataSourceSettingsByUid.bind(Object(o.getDataSourceSrv)())});var c=Object(n.b)().getDataLinkUIModel(t,u,e);return c.title||(c.title=function(e){e.indexOf("://")<0&&(e="http://".concat(e));var t;try{var r=new URL(e);t=r.hostname}catch(r){t=e}return t}(c.href)),c})):[]}},aCH8:function(e,t,r){var n,a,o,i,u;n=r("ANhw"),a=r("mmNF").utf8,o=r("BEtg"),i=r("mmNF").bin,(u=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?i.stringToBytes(e):a.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=n.bytesToWords(e),c=8*e.length,s=1732584193,l=-271733879,f=-1732584194,p=271733878,m=0;m<r.length;m++)r[m]=16711935&(r[m]<<8|r[m]>>>24)|4278255360&(r[m]<<24|r[m]>>>8);r[c>>>5]|=128<<c%32,r[14+(c+64>>>9<<4)]=c;var b=u._ff,d=u._gg,h=u._hh,v=u._ii;for(m=0;m<r.length;m+=16){var y=s,g=l,O=f,w=p;s=b(s,l,f,p,r[m+0],7,-680876936),p=b(p,s,l,f,r[m+1],12,-389564586),f=b(f,p,s,l,r[m+2],17,606105819),l=b(l,f,p,s,r[m+3],22,-1044525330),s=b(s,l,f,p,r[m+4],7,-176418897),p=b(p,s,l,f,r[m+5],12,1200080426),f=b(f,p,s,l,r[m+6],17,-1473231341),l=b(l,f,p,s,r[m+7],22,-45705983),s=b(s,l,f,p,r[m+8],7,1770035416),p=b(p,s,l,f,r[m+9],12,-1958414417),f=b(f,p,s,l,r[m+10],17,-42063),l=b(l,f,p,s,r[m+11],22,-1990404162),s=b(s,l,f,p,r[m+12],7,1804603682),p=b(p,s,l,f,r[m+13],12,-40341101),f=b(f,p,s,l,r[m+14],17,-1502002290),s=d(s,l=b(l,f,p,s,r[m+15],22,1236535329),f,p,r[m+1],5,-165796510),p=d(p,s,l,f,r[m+6],9,-1069501632),f=d(f,p,s,l,r[m+11],14,643717713),l=d(l,f,p,s,r[m+0],20,-373897302),s=d(s,l,f,p,r[m+5],5,-701558691),p=d(p,s,l,f,r[m+10],9,38016083),f=d(f,p,s,l,r[m+15],14,-660478335),l=d(l,f,p,s,r[m+4],20,-405537848),s=d(s,l,f,p,r[m+9],5,568446438),p=d(p,s,l,f,r[m+14],9,-1019803690),f=d(f,p,s,l,r[m+3],14,-187363961),l=d(l,f,p,s,r[m+8],20,1163531501),s=d(s,l,f,p,r[m+13],5,-1444681467),p=d(p,s,l,f,r[m+2],9,-51403784),f=d(f,p,s,l,r[m+7],14,1735328473),s=h(s,l=d(l,f,p,s,r[m+12],20,-1926607734),f,p,r[m+5],4,-378558),p=h(p,s,l,f,r[m+8],11,-2022574463),f=h(f,p,s,l,r[m+11],16,1839030562),l=h(l,f,p,s,r[m+14],23,-35309556),s=h(s,l,f,p,r[m+1],4,-1530992060),p=h(p,s,l,f,r[m+4],11,1272893353),f=h(f,p,s,l,r[m+7],16,-155497632),l=h(l,f,p,s,r[m+10],23,-1094730640),s=h(s,l,f,p,r[m+13],4,681279174),p=h(p,s,l,f,r[m+0],11,-358537222),f=h(f,p,s,l,r[m+3],16,-722521979),l=h(l,f,p,s,r[m+6],23,76029189),s=h(s,l,f,p,r[m+9],4,-640364487),p=h(p,s,l,f,r[m+12],11,-421815835),f=h(f,p,s,l,r[m+15],16,530742520),s=v(s,l=h(l,f,p,s,r[m+2],23,-995338651),f,p,r[m+0],6,-198630844),p=v(p,s,l,f,r[m+7],10,1126891415),f=v(f,p,s,l,r[m+14],15,-1416354905),l=v(l,f,p,s,r[m+5],21,-57434055),s=v(s,l,f,p,r[m+12],6,1700485571),p=v(p,s,l,f,r[m+3],10,-1894986606),f=v(f,p,s,l,r[m+10],15,-1051523),l=v(l,f,p,s,r[m+1],21,-2054922799),s=v(s,l,f,p,r[m+8],6,1873313359),p=v(p,s,l,f,r[m+15],10,-30611744),f=v(f,p,s,l,r[m+6],15,-1560198380),l=v(l,f,p,s,r[m+13],21,1309151649),s=v(s,l,f,p,r[m+4],6,-145523070),p=v(p,s,l,f,r[m+11],10,-1120210379),f=v(f,p,s,l,r[m+2],15,718787259),l=v(l,f,p,s,r[m+9],21,-343485551),s=s+y>>>0,l=l+g>>>0,f=f+O>>>0,p=p+w>>>0}return n.endian([s,l,f,p])})._ff=function(e,t,r,n,a,o,i){var u=e+(t&r|~t&n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._gg=function(e,t,r,n,a,o,i){var u=e+(t&n|r&~n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._hh=function(e,t,r,n,a,o,i){var u=e+(t^r^n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._ii=function(e,t,r,n,a,o,i){var u=e+(r^(t|~n))+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._blocksize=16,u._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(u(e,t));return t&&t.asBytes?r:t&&t.asString?i.bytesToString(r):n.bytesToHex(r)}},kGJw:function(e,t,r){var n=r("dt0z"),a=/[\\^$.*+?()[\]{}|]/g,o=RegExp(a.source);e.exports=function(e){return(e=n(e))&&o.test(e)?e.replace(a,"\\$&"):e}},mmNF:function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},tLXD:function(e,t,r){"use strict";var n=r("q1tI");t.a=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e})),t.current}}}]);
//# sourceMappingURL=lokiPlugin.4e20f99bf66682942589.js.map