{"version":3,"sources":["webpack:///./public/app/features/plugins/AppRootPage.tsx"],"names":["getAppPluginPageError","meta","type","PluginType","app","enabled","AppRootPage","props","onNavChanged","nav","setState","state","loading","pluginId","this","getPluginSettings","then","info","error","appEvents","emit","AppEvents","alertError","getWarningNav","importAppPlugin","plugin","getNotFoundNav","path","query","root","navModel","Contents","isLoading","Component","hot","module","connect","location","routeParams","slug"],"mappings":"ysCA4BO,SAASA,EAAsBC,GACpC,OAAKA,EAGDA,EAAKC,OAASC,aAAWC,IACpB,wBAEJH,EAAKI,QAGH,KAFE,0BANA,iB,IAWLC,E,YACJ,WAAYC,GAAc,a,4FAAA,UACxB,wBAAMA,KA6BRC,aAAe,SAACC,GACd,EAAKC,SAAS,CAAED,SA7BhB,EAAKE,MAAQ,CACXC,SAAS,GAHa,E,mbAQhBC,EAAaC,KAAKP,MAAlBM,S,kBAGYE,YAAkBF,GAAUG,MAAK,SAAAC,GACjD,IAAMC,EAAQlB,EAAsBiB,GACpC,OAAIC,GACFC,IAAUC,KAAKC,YAAUC,WAAY,CAACJ,IACtC,EAAKR,SAAS,CAAED,IAAKc,YAAcL,KAC5B,MAEFM,YAAgBP,M,OAPnBb,E,OASNU,KAAKJ,SAAS,CAAEe,OAAQrB,EAAKQ,SAAS,I,gDAEtCE,KAAKJ,SAAS,CACZe,OAAQ,KACRb,SAAS,EACTH,IAAqEiB,gB,oTASlE,MACiBZ,KAAKP,MAArBoB,EADD,EACCA,KAAMC,EADP,EACOA,MADP,EAE0Bd,KAAKH,MAA9BC,EAFD,EAECA,QAASa,EAFV,EAEUA,OAAQhB,EAFlB,EAEkBA,IAEzB,OAAIgB,IAAWA,EAAOI,KAEb,4CAIJpB,EAQH,kBAAC,IAAD,CAAMqB,SAAUrB,GACd,kBAAC,IAAKsB,SAAN,CAAeC,UAAWpB,GACvBa,GAAUA,EAAOI,MAChB,kBAACJ,EAAOI,KAAR,CAAa5B,KAAMwB,EAAOxB,KAAM2B,MAAOA,EAAOD,KAAMA,EAAMnB,aAAcM,KAAKN,iBAV/EiB,GAAUA,EAAOI,KACZ,kBAACJ,EAAOI,KAAR,CAAa5B,KAAMwB,EAAOxB,KAAM2B,MAAOA,EAAOD,KAAMA,EAAMnB,aAAcM,KAAKN,eAE/E,kBAAC,IAAD,W,8BAjDayB,aAuEXC,wBAAIC,EAAJD,CAAYE,mBAPH,SAACzB,GAAD,MAAwB,CAC9CE,SAAUF,EAAM0B,SAASC,YAAYzB,SACrC0B,KAAM5B,EAAM0B,SAASC,YAAYC,KACjCX,MAAOjB,EAAM0B,SAAST,MACtBD,KAAMhB,EAAM0B,SAASV,QAGIS,CAAyB9B,K","file":"AppRootPage.4e20f99bf66682942589.js","sourcesContent":["// Libraries\nimport React, { Component } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\n// Types\nimport { StoreState } from 'app/types';\nimport { AppEvents, AppPlugin, AppPluginMeta, NavModel, PluginType, UrlQueryMap } from '@grafana/data';\n\nimport Page from 'app/core/components/Page/Page';\nimport { getPluginSettings } from './PluginSettingsCache';\nimport { importAppPlugin } from './plugin_loader';\nimport { getNotFoundNav, getWarningNav, getExceptionNav } from 'app/core/nav_model_srv';\nimport { appEvents } from 'app/core/core';\nimport PageLoader from 'app/core/components/PageLoader/PageLoader';\n\ninterface Props {\n  pluginId: string; // From the angular router\n  query: UrlQueryMap;\n  path: string;\n  slug?: string;\n}\n\ninterface State {\n  loading: boolean;\n  plugin?: AppPlugin | null;\n  nav?: NavModel;\n}\n\nexport function getAppPluginPageError(meta: AppPluginMeta) {\n  if (!meta) {\n    return 'Unknown Plugin';\n  }\n  if (meta.type !== PluginType.app) {\n    return 'Plugin must be an app';\n  }\n  if (!meta.enabled) {\n    return 'Application Not Enabled';\n  }\n  return null;\n}\n\nclass AppRootPage extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      loading: true,\n    };\n  }\n\n  async componentDidMount() {\n    const { pluginId } = this.props;\n\n    try {\n      const app = await getPluginSettings(pluginId).then(info => {\n        const error = getAppPluginPageError(info);\n        if (error) {\n          appEvents.emit(AppEvents.alertError, [error]);\n          this.setState({ nav: getWarningNav(error) });\n          return null;\n        }\n        return importAppPlugin(info);\n      });\n      this.setState({ plugin: app, loading: false });\n    } catch (err) {\n      this.setState({\n        plugin: null,\n        loading: false,\n        nav: process.env.NODE_ENV === 'development' ? getExceptionNav(err) : getNotFoundNav(),\n      });\n    }\n  }\n\n  onNavChanged = (nav: NavModel) => {\n    this.setState({ nav });\n  };\n\n  render() {\n    const { path, query } = this.props;\n    const { loading, plugin, nav } = this.state;\n\n    if (plugin && !plugin.root) {\n      // TODO? redirect to plugin page?\n      return <div>No Root App</div>;\n    }\n\n    // When no naviagion is set, give full control to the app plugin\n    if (!nav) {\n      if (plugin && plugin.root) {\n        return <plugin.root meta={plugin.meta} query={query} path={path} onNavChanged={this.onNavChanged} />;\n      }\n      return <PageLoader />;\n    }\n\n    return (\n      <Page navModel={nav}>\n        <Page.Contents isLoading={loading}>\n          {plugin && plugin.root && (\n            <plugin.root meta={plugin.meta} query={query} path={path} onNavChanged={this.onNavChanged} />\n          )}\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nconst mapStateToProps = (state: StoreState) => ({\n  pluginId: state.location.routeParams.pluginId,\n  slug: state.location.routeParams.slug,\n  query: state.location.query,\n  path: state.location.path,\n});\n\nexport default hot(module)(connect(mapStateToProps)(AppRootPage));\n"],"sourceRoot":""}